import{Bubble as x}from"./index.CSXvuRu2.js";import{L as M,E,q as D,M as m,t as S,C as j,N as q,r as P,O as T,P as H,Q as w,J as O,R as L,K as W}from"./sparkTitle.DCU_Odjx.js";import{C as A,R as F}from"./Circle.BsfAXaX2.js";import{E as I}from"./ExternalInteractorBase.CIi3zRdK.js";import"./OptionsColor.BuOxyFYl.js";import"./cn.Bh4i3_zX.js";import"./index.NEDEFKed.js";import"./motion.DhRAmCJf.js";function R(y,o,e,n){if(o>=e){const b=y+(o-e)*n;return M(b,y,o)}else if(o<e){const b=y-(e-o)*n;return M(b,o,y)}}const v="bubble",C=0,J=0,K=2,_=1,k=1,N=0,Q=0,g=.5,z=1;class ie extends I{constructor(o){super(o),this._clickBubble=()=>{const e=this.container,n=e.actualOptions,b=e.interactivity.mouse.clickPosition,s=n.interactivity.modes.bubble;if(!s||!b)return;e.bubble||(e.bubble={});const t=e.retina.bubbleModeDistance;if(!t||t<C)return;const l=e.particles.quadTree.queryCircle(b,t,i=>this.isEnabled(i)),{bubble:a}=e;for(const i of l){if(!a.clicking)continue;i.bubble.inRange=!a.durationEnd;const r=i.getPosition(),c=E(r,b),f=(new Date().getTime()-(e.interactivity.mouse.clickTime??J))/D;f>s.duration&&(a.durationEnd=!0),f>s.duration*K&&(a.clicking=!1,a.durationEnd=!1);const d={bubbleObj:{optValue:e.retina.bubbleModeSize,value:i.bubble.radius},particlesObj:{optValue:m(i.options.size.value)*e.retina.pixelRatio,value:i.size.value},type:"size"};this._process(i,c,f,d);const p={bubbleObj:{optValue:s.opacity,value:i.bubble.opacity},particlesObj:{optValue:m(i.options.opacity.value),value:i.opacity?.value??_},type:"opacity"};this._process(i,c,f,p),!a.durationEnd&&c<=t?this._hoverBubbleColor(i,c):delete i.bubble.color}},this._hoverBubble=()=>{const e=this.container,n=e.interactivity.mouse.position,b=e.retina.bubbleModeDistance;if(!b||b<C||!n)return;const s=e.particles.quadTree.queryCircle(n,b,t=>this.isEnabled(t));for(const t of s){t.bubble.inRange=!0;const l=t.getPosition(),a=E(l,n),i=k-a/b;a<=b?i>=Q&&e.interactivity.status===S&&(this._hoverBubbleSize(t,i),this._hoverBubbleOpacity(t,i),this._hoverBubbleColor(t,i)):this.reset(t),e.interactivity.status===j&&this.reset(t)}},this._hoverBubbleColor=(e,n,b)=>{const s=this.container.actualOptions,t=b??s.interactivity.modes.bubble;if(t){if(!e.bubble.finalColor){const l=t.color;if(!l)return;const a=q(l);e.bubble.finalColor=P(a)}if(e.bubble.finalColor)if(t.mix){e.bubble.color=void 0;const l=e.getFillColor();e.bubble.color=l?T(H(l,e.bubble.finalColor,k-n,n)):e.bubble.finalColor}else e.bubble.color=e.bubble.finalColor}},this._hoverBubbleOpacity=(e,n,b)=>{const s=this.container,t=s.actualOptions,l=b?.opacity??t.interactivity.modes.bubble?.opacity;if(!l)return;const a=e.options.opacity.value,i=e.opacity?.value??_,r=R(i,l,m(a),n);r!==void 0&&(e.bubble.opacity=r)},this._hoverBubbleSize=(e,n,b)=>{const s=this.container,t=b?.size?b.size*s.retina.pixelRatio:s.retina.bubbleModeSize;if(t===void 0)return;const l=m(e.options.size.value)*s.retina.pixelRatio,a=e.size.value,i=R(a,t,l,n);i!==void 0&&(e.bubble.radius=i)},this._process=(e,n,b,s)=>{const t=this.container,l=s.bubbleObj.optValue,a=t.actualOptions,i=a.interactivity.modes.bubble;if(!i||l===void 0)return;const r=i.duration,c=t.retina.bubbleModeDistance,f=s.particlesObj.optValue,d=s.bubbleObj.value,p=s.particlesObj.value??N,u=s.type;if(!(!c||c<C||l===f))if(t.bubble||(t.bubble={}),t.bubble.durationEnd)d&&(u==="size"&&delete e.bubble.radius,u==="opacity"&&delete e.bubble.opacity);else if(n<=c){if((d??p)!==l){const h=p-b*(p-l)/r;u==="size"&&(e.bubble.radius=h),u==="opacity"&&(e.bubble.opacity=h)}}else u==="size"&&delete e.bubble.radius,u==="opacity"&&delete e.bubble.opacity},this._singleSelectorHover=(e,n,b)=>{const s=this.container,t=document.querySelectorAll(n),l=s.actualOptions.interactivity.modes.bubble;!l||!t.length||t.forEach(a=>{const i=a,r=s.retina.pixelRatio,c={x:(i.offsetLeft+i.offsetWidth*g)*r,y:(i.offsetTop+i.offsetHeight*g)*r},f=i.offsetWidth*g*r,d=b.type==="circle"?new A(c.x,c.y,f):new F(i.offsetLeft*r,i.offsetTop*r,i.offsetWidth*r,i.offsetHeight*r),p=s.particles.quadTree.query(d,u=>this.isEnabled(u));for(const u of p){if(!d.contains(u.getPosition()))continue;u.bubble.inRange=!0;const B=l.divs,h=w(B,i);(!u.bubble.div||u.bubble.div!==i)&&(this.clear(u,e,!0),u.bubble.div=i),this._hoverBubbleSize(u,z,h),this._hoverBubbleOpacity(u,z,h),this._hoverBubbleColor(u,z,h)}})},o.bubble||(o.bubble={}),this.handleClickMode=e=>{e===v&&(o.bubble||(o.bubble={}),o.bubble.clicking=!0)}}clear(o,e,n){o.bubble.inRange&&!n||(delete o.bubble.div,delete o.bubble.opacity,delete o.bubble.radius,delete o.bubble.color)}init(){const o=this.container,e=o.actualOptions.interactivity.modes.bubble;e&&(o.retina.bubbleModeDistance=e.distance*o.retina.pixelRatio,e.size!==void 0&&(o.retina.bubbleModeSize=e.size*o.retina.pixelRatio))}async interact(o){const e=this.container.actualOptions,n=e.interactivity.events,b=n.onHover,s=n.onClick,t=b.enable,l=b.mode,a=s.enable,i=s.mode,r=n.onDiv;t&&O(v,l)?this._hoverBubble():a&&O(v,i)?this._clickBubble():L(v,r,(c,f)=>this._singleSelectorHover(o,c,f)),await Promise.resolve()}isEnabled(o){const e=this.container,n=e.actualOptions,b=e.interactivity.mouse,s=(o?.interactivity??n.interactivity).events,{onClick:t,onDiv:l,onHover:a}=s,i=W(v,l);return i||a.enable&&b.position||t.enable&&b.clickPosition?O(v,a.mode)||O(v,t.mode)||i:!1}loadModeOptions(o,...e){o.bubble||(o.bubble=new x);for(const n of e)o.bubble.load(n?.bubble)}reset(o){o.bubble.inRange=!1}}export{ie as Bubbler};
