import{_ as x,J as D,Z as d,e as v,N as g,M as u}from"./sparkTitle.DCU_Odjx.js";import{v as j}from"./index.BIjXtLGa.js";import"./cn.Bh4i3_zX.js";import"./index.NEDEFKed.js";import"./motion.DhRAmCJf.js";const h='"Twemoji Mozilla", Apple Color Emoji, "Segoe UI Emoji", "Noto Color Emoji", "EmojiOne Color"';class C{constructor(){this._emojiShapeDict=new Map}destroy(){for(const[a,e]of this._emojiShapeDict)e instanceof ImageBitmap&&(e?.close(),this._emojiShapeDict.delete(a))}async draw(a){const{drawEmoji:e}=await x(async()=>{const{drawEmoji:r}=await import("./Utils.BXQkxA-7.js");return{drawEmoji:r}},[]);e(a)}async init(a){const e=a.actualOptions;if(!j.find(t=>D(t,e.particles.shape.type)))return;const r=[d(h)],n=j.map(t=>e.particles.shape.options[t]).find(t=>!!t);n&&v(n,t=>{t.font&&r.push(d(t.font))}),await Promise.all(r)}particleDestroy(a){delete a.emojiData}async particleInit(a,e){const n=e.shapeData;if(!n?.value)return;const t=g(n.value,e.randomIndexData),c=n.font??h;if(!t)return;const p=`${t}_${c}`,f=this._emojiShapeDict.get(p);if(f){e.emojiData=f;return}const l=u(e.size.value)*2;let m;const s=u(e.size.value);if(typeof OffscreenCanvas<"u"){const i=new OffscreenCanvas(l,l),o=i.getContext("2d");if(!o)return;o.font=`400 ${s*2}px ${c}`,o.textBaseline="middle",o.textAlign="center",o.fillText(t,s,s),m=i.transferToImageBitmap()}else{const i=document.createElement("canvas");i.width=l,i.height=l;const o=i.getContext("2d");if(!o)return;o.font=`400 ${s*2}px ${c}`,o.textBaseline="middle",o.textAlign="center",o.fillText(t,s,s),m=i}this._emojiShapeDict.set(p,m),e.emojiData=m,await Promise.resolve()}}export{C as EmojiDrawer};
