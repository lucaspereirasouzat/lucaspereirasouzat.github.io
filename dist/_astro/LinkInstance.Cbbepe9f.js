import{E as m,V as L,n as _,m as C,Y as O,H as S,T as v}from"./sparkTitle.DCU_Odjx.js";import{f as q}from"./CanvasUtils.5nKfh4B1.js";import"./cn.Bh4i3_zX.js";import"./index.NEDEFKed.js";import"./motion.DhRAmCJf.js";function R(a,o,n,i){a.beginPath(),a.moveTo(o.x,o.y),a.lineTo(n.x,n.y),a.lineTo(i.x,i.y),a.closePath()}function W(a){let o=!1;const{begin:n,end:i,maxDistance:s,context:t,canvasSize:e,width:l,backgroundMask:d,colorLine:f,opacity:p,links:u}=a;if(m(n,i)<=s)q(t,n,i),o=!0;else if(u.warp){let r,g;const x={x:i.x-e.width,y:i.y},h=L(n,x);if(h.distance<=s){const c=n.y-h.dy/h.dx*n.x;r={x:0,y:c},g={x:e.width,y:c}}else{const c={x:i.x,y:i.y-e.height},y=L(n,c);if(y.distance<=s){const w=-(n.y-y.dy/y.dx*n.x)/(y.dy/y.dx);r={x:w,y:0},g={x:w,y:e.height}}else{const b={x:i.x-e.width,y:i.y-e.height},w=L(n,b);if(w.distance<=s){const F=n.y-w.dy/w.dx*n.x;r={x:-F/(w.dy/w.dx),y:F},g={x:r.x+e.width,y:r.y+e.height}}}}r&&g&&(q(t,n,r),q(t,i,g),o=!0)}if(!o)return;t.lineWidth=l,d.enable&&(t.globalCompositeOperation=d.composite),t.strokeStyle=_(f,p);const{shadow:k}=u;if(k.enable){const r=C(k.color);r&&(t.shadowBlur=k.blur,t.shadowColor=_(r))}t.stroke()}function z(a){const{context:o,pos1:n,pos2:i,pos3:s,backgroundMask:t,colorTriangle:e,opacityTriangle:l}=a;R(o,n,i,s),t.enable&&(o.globalCompositeOperation=t.composite),o.fillStyle=_(e,l),o.fill()}function E(a){return a.sort((o,n)=>o-n),a.join("_")}function D(a,o){const n=E(a.map(s=>s.id));let i=o.get(n);return i===void 0&&(i=O(),o.set(n,i)),i}const M=0,T=0,P=0,I=.5;class Y{constructor(o){this.container=o,this._drawLinkLine=(n,i)=>{const s=n.options.links;if(!s?.enable)return;const t=this.container,e=t.actualOptions,l=i.destination,d=n.getPosition(),f=l.getPosition();let p=i.opacity;t.canvas.draw(u=>{let k;const r=n.options.twinkle?.lines;if(r?.enable){const c=r.frequency,y=C(r.color);O()<c&&y&&(k=y,p=S(r.opacity))}if(!k){const c=s.id!==void 0?t.particles.linksColors.get(s.id):t.particles.linksColor;k=v(n,l,c)}if(!k)return;const g=n.retina.linksWidth??T,x=n.retina.linksDistance??P,{backgroundMask:h}=e;W({context:u,width:g,begin:d,end:f,maxDistance:x,canvasSize:t.canvas.size,links:s,backgroundMask:h,colorLine:k,opacity:p})})},this._drawLinkTriangle=(n,i,s)=>{const t=n.options.links;if(!t?.enable)return;const e=t.triangles;if(!e.enable)return;const l=this.container,d=l.actualOptions,f=i.destination,p=s.destination,u=e.opacity??(i.opacity+s.opacity)*I;u<=M||l.canvas.draw(k=>{const r=n.getPosition(),g=f.getPosition(),x=p.getPosition(),h=n.retina.linksDistance??P;if(m(r,g)>h||m(x,g)>h||m(x,r)>h)return;let c=C(e.color);if(!c){const y=t.id!==void 0?l.particles.linksColors.get(t.id):l.particles.linksColor;c=v(n,f,y)}c&&z({context:k,pos1:r,pos2:g,pos3:x,backgroundMask:d.backgroundMask,colorTriangle:c,opacityTriangle:u})})},this._drawTriangles=(n,i,s,t)=>{const e=s.destination;if(!(n.links?.triangles.enable&&e.options.links?.triangles.enable))return;const l=e.links?.filter(d=>{const f=this._getLinkFrequency(e,d.destination);return e.options.links&&f<=e.options.links.frequency&&t.findIndex(u=>u.destination===d.destination)>=0});if(l?.length)for(const d of l){const f=d.destination;this._getTriangleFrequency(i,e,f)>n.links.triangles.frequency||this._drawLinkTriangle(i,s,d)}},this._getLinkFrequency=(n,i)=>D([n,i],this._freqs.links),this._getTriangleFrequency=(n,i,s)=>D([n,i,s],this._freqs.triangles),this._freqs={links:new Map,triangles:new Map}}async drawParticle(o,n){const{links:i,options:s}=n;if(!i?.length)return;const t=i.filter(e=>s.links&&this._getLinkFrequency(n,e.destination)<=s.links.frequency);for(const e of t)this._drawTriangles(s,n,e,t),e.opacity>M&&(n.retina.linksWidth??T)>T&&this._drawLinkLine(n,e);await Promise.resolve()}async init(){this._freqs.links=new Map,this._freqs.triangles=new Map,await Promise.resolve()}particleCreated(o){if(o.links=[],!o.options.links)return;const n=this.container.retina.pixelRatio,{retina:i}=o,{distance:s,width:t}=o.options.links;i.linksDistance=s*n,i.linksWidth=t*n}particleDestroyed(o){o.links=[]}}export{Y as LinkInstance};
